import os
for key in ["HTTP_PROXY", "HTTPS_PROXY", "ALL_PROXY", "http_proxy", "https_proxy", "all_proxy"]:
    os.environ.pop(key, None)

import asyncio
import re
import json
import httpx
from datetime import datetime, timedelta

# ===================== ChatOllama å…¼å®¹å¯¼å…¥ =====================
try:
    from langchain_ollama import ChatOllama
    print("âœ… Using ChatOllama from langchain-ollama")
except ImportError:
    try:
        from langchain_community.chat_models import ChatOllama
        print("âœ… Using ChatOllama from langchain_community")
    except ImportError:
        from langchain.chat_models import ChatOllama
        print("âš ï¸ Using ChatOllama from old langchain (may be deprecated)")

from langchain.schema import HumanMessage

# ===================== æ¨¡å‹ä¼˜å…ˆçº§å®šä¹‰ =====================
REMOTE_OLLAMA_URL = "http://192.168.92.13:11434"  # â† ä¿®æ”¹ä¸ºä½ çš„è¿œç¨‹ Ollama åœ°å€
REMOTE_MODEL = "gemma3:27b"
LOCAL_MODEL = "qwen2.5:1.5b"


async def is_remote_ollama_available(base_url: str, timeout: float = 3.0) -> bool:
    """
    æ£€æŸ¥è¿œç¨‹ Ollama æœåŠ¡æ˜¯å¦å¯è®¿é—®ã€‚
    """
    try:
        async with httpx.AsyncClient(timeout=timeout) as client:
            resp = await client.get(f"{base_url}/api/tags")
            if resp.status_code == 200:
                #print(f"ğŸŒ Remote Ollama available at {base_url}")
                return True
    except Exception as e:
        print(f"âš ï¸ Remote Ollama not reachable: {e}")
    return False


async def get_llm() -> ChatOllama:
    """
    ä¼˜å…ˆä½¿ç”¨è¿œç¨‹ gemma3:27bï¼Œå¦‚æœè¿œç¨‹ä¸å¯ç”¨åˆ™å›é€€åˆ°æœ¬åœ° qwen2.5:1.5bã€‚
    """
    if await is_remote_ollama_available(REMOTE_OLLAMA_URL):
        #print(f"âœ… Using remote model: {REMOTE_MODEL}")
        return ChatOllama(model=REMOTE_MODEL, base_url=REMOTE_OLLAMA_URL)
    else:
        print(f"ğŸ”„ Falling back to local model: {LOCAL_MODEL}")
        return ChatOllama(model=LOCAL_MODEL)

"""
åœ¨æ— ç¤ºä¾‹æƒ…å†µä¸‹ï¼Œå¦‚æœå¤§æ¨¡å‹ç²¾åº¦å·®å¼ºäººæ„ï¼Œå¯ä»¥å°†ç¤ºä¾‹æ’å…¥promptçš„[æ³¨æ„]å’Œ[ç”¨æˆ·è¾“å…¥ï¼š"{user_input}"]ä¹‹é—´ï¼Œä½†æ˜¯æ— æ³•é¿å…LLMç›´æ¥æ‹¿æ¥ç¼–
ç¤ºä¾‹ï¼š
è¾“å…¥ï¼š"æŸ¥è¯¢ä»Šå¹´çš„3030è¿é€€çº¯æ°´ä½¿ç”¨é‡"
è¾“å‡ºï¼š{{"indicator":"3030è¿é€€çº¯æ°´ä½¿ç”¨é‡","timeString":"{now.year}","timeType":"YEAR"}}

è¾“å…¥ï¼š"ä»Šå¤©çš„è¿é€€çº¯æ°´ä½¿ç”¨é‡"
è¾“å‡ºï¼š{{"indicator":"è¿é€€çº¯æ°´ä½¿ç”¨é‡","timeString":"{now.strftime('%Y-%m-%d')}","timeType":"DAY"}}

è¾“å…¥ï¼š"ä»Šå¤©"
è¾“å‡ºï¼š{{"indicator":null,"timeString":"{now.strftime('%Y-%m-%d')}","timeType":"DAY"}}

è¾“å…¥ï¼š"å†·è½§è’¸æ±½æ¶ˆè€—"
è¾“å‡ºï¼š{{"indicator":"å†·è½§è’¸æ±½æ¶ˆè€—","timeString":null,"timeType":null}}

è¾“å…¥ï¼š"8æœˆä»½å†·è½§è’¸æ±½æ¶ˆè€—"
è¾“å‡ºï¼š{{"indicator":"å†·è½§è’¸æ±½æ¶ˆè€—","timeString":"{now.year}-08","timeType":"MONTH"}}

è¾“å…¥ï¼š"2024å¹´ç¬¬31å‘¨çº¯æ°´æŸå¤±ç‡"
è¾“å‡ºï¼š{{"indicator":"çº¯æ°´æŸå¤±ç‡","timeString":"2024-W31","timeType":"WEEK"}}

è¾“å…¥ï¼š"2017å¹´ç¬¬1å­£åº¦çº¯æ°´æŸå¤±ç‡"
è¾“å‡ºï¼š{{"indicator":"çº¯æ°´æŸå¤±ç‡","timeString":"2017 Q1","timeType":"QUARTER"}}

è¾“å…¥ï¼š"2019å¹´8æœˆä¸‹æ—¬å†·è½§è’¸æ±½æ¶ˆè€—"
è¾“å‡ºï¼š{{"indicator":"å†·è½§è’¸æ±½æ¶ˆè€—","timeString":"2019-08 ä¸‹æ—¬","timeType":"TENDAYS"}}

è¾“å…¥ï¼š"å‰å¤©æ™šç­çš„å†·è½§è’¸æ±½æ¶ˆè€—"
è¾“å‡ºï¼š{{"indicator":"å†·è½§è’¸æ±½æ¶ˆè€—","timeString":"{(now - timedelta(days=2)).strftime('%Y-%m-%d')} æ™šç­","timeType":"SHIFT"}}

è¾“å…¥ï¼š"ä¸‹å‘¨çš„å¨é’¢ç”¨æ°´é‡"
è¾“å‡ºï¼š{{"indicator":"å¨é’¢ç”¨æ°´é‡","timeString":"{(now + timedelta(weeks=1)).isocalendar()[0]} W{(now + timedelta(weeks=1)).isocalendar()[1]}","timeType":"WEEK"}}

è¾“å…¥ï¼š"ä»Šå¹´10æœˆ14æ—¥é…¸è½§çº¯æ°´ä½¿ç”¨é‡"
è¾“å‡ºï¼š{{"indicator":"é…¸è½§çº¯æ°´ä½¿ç”¨é‡","timeString":"2025-10-14","timeType":"DAY"}}
"""

# ===================== ä¸»è§£æå‡½æ•° =====================
async def parse_user_input(user_input: str, now: datetime = None):
    if now is None:
        now = datetime.now()
    now_str = now.strftime("%Y-%m-%d %H:%M")

    prompt = f"""
ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½è§£æåŠ©æ‰‹ï¼Œç”¨äºä»ç”¨æˆ·è¾“å…¥ä¸­æå–â€œæŒ‡æ ‡åç§°â€å’Œâ€œæ—¶é—´ä¿¡æ¯â€ã€‚
å½“å‰ç³»ç»Ÿæ—¶é—´ä¸ºï¼š{now_str}ã€‚

è¯·ä¸¥æ ¼è¾“å‡º JSONï¼š
{{
  "indicator": "...",
  "timeString": "...",
  "timeType": "..."
}}

è¦æ±‚ï¼š
1. indicator å¿…é¡»ä¿ç•™åŸæ–‡ï¼ŒåŒ…æ‹¬æ•°å­—å’Œæ–‡å­—ï¼Œä¸è¦ä¸¢å¤±ä»»ä½•ä¿¡æ¯ã€‚
   - å¦‚æœæ•°å­—ç´§è·Ÿåœ¨æŒ‡æ ‡è¯ä¸­ï¼ˆå¦‚â€œ2030é…¸è½§çº¯æ°´ä½¿ç”¨é‡â€ã€â€œ3030è¿é€€çº¯æ°´ä½¿ç”¨é‡â€ï¼‰ï¼Œåˆ™è§†ä¸ºæŒ‡æ ‡ä¸€éƒ¨åˆ†ï¼Œè€Œéæ—¶é—´ã€‚
   - åªæœ‰å½“æ•°å­—åé¢å¸¦æœ‰â€œå¹´â€â€œæœˆä»½â€â€œæœˆâ€â€œå‘¨â€â€œå­£åº¦â€â€œæ—¥â€ç­‰æ—¶é—´ä¿®é¥°è¯æ—¶ï¼Œæ‰è§†ä¸ºæ—¶é—´ã€‚
   - ä¸è¦å› ä¸ºæŒ‡æ ‡ä¸­åŒ…å«æ•°å­—å°±å°†å…¶è¯¯åˆ¤ä¸ºæ—¶é—´ã€‚
   - å¦‚æœèƒ½å¤Ÿæ˜ç¡®ç”¨æˆ·è¾“å…¥å°±æ˜¯æŒ‡æ˜æ—¶é—´ç‚¹æˆ–è€…æ—¶é—´åŒºé—´ï¼Œindicator å°±è®¾ä¸ºnull(å¦‚â€œç¬¬å››å‘¨â€ã€â€œä»Šå¹´ä¸‰æœˆä»½â€ã€â€œ2022å¹´5æœˆ20æ—¥â€, â€œä»Šå¹´ä¸€æœˆåˆ°äº”æœˆâ€, "ä¸ŠåŠå¹´")ã€‚
   - æŒ‡æ ‡ä¸­å¯èƒ½åŒ…å«æè¿°æ€§è´¨çš„åç¼€è¯ï¼ˆå¦‚â€œç´¯è®¡â€ã€â€œè®¡åˆ’â€ã€â€œç›®æ ‡â€ã€â€œå®Œæˆå€¼â€ã€â€œç”¨é‡â€ã€â€œæŒ‡æ ‡â€ã€â€œæˆæœ¬â€ã€â€œæ•ˆç‡â€ã€â€œæ€»é‡â€ã€â€œå•è€—â€ã€â€œå¼ºåº¦â€ç­‰ï¼‰ï¼Œ
     è¿™äº›è¯å‡å±äºæŒ‡æ ‡çš„ä¸€éƒ¨åˆ†ï¼Œå¿…é¡»ä¿ç•™åœ¨ indicator ä¸­ï¼Œä¸å¾—æˆªæ–­ã€‚

2. timeString å¿…é¡»æ ¹æ® timeType ç²¾ç¡®æ ¼å¼åŒ–ï¼š
   - HOUR â†’ "YYYY-MM-DD HH"
   - SHIFT â†’ "YYYY-MM-DD æ—©ç­/ç™½ç­/å¤œç­"
     - â€œæ—©ç­â€ã€â€œç™½ç­â€ã€â€œå¤œç­â€ã€â€œä¸­ç­â€ã€â€œæ™šç­â€ éƒ½å±äº SHIFT ç±»å‹ã€‚
     - ç­æ¬¡ä¼˜å…ˆçº§é«˜äº HOURã€‚å³å¦‚æœå¥ä¸­å‡ºç°â€œæ—©ç­/ç™½ç­/å¤œç­â€ï¼Œæ— è®ºæ˜¯å¦åŒæ—¶å‡ºç°â€œå‡ ç‚¹â€ï¼Œéƒ½æŒ‰ SHIFT è§£æã€‚
     - æ—¥æœŸè®¡ç®—è§„åˆ™ä¸ DAY ç›¸åŒï¼š  
       â€œæ˜¨å¤©æ—©ç­â€ â†’ (now - timedelta(days=1)).strftime("%Y-%m-%d") + " æ—©ç­"
       â€œä»Šå¤©ç™½ç­â€ â†’ now.strftime("%Y-%m-%d") + " ç™½ç­"
       â€œæ˜å¤©å¤œç­â€ â†’ (now + timedelta(days=1)).strftime("%Y-%m-%d") + " å¤œç­"
   - DAY â†’ "YYYY-MM-DD"
   - WEEK â†’ "YYYY W##"
     - ä½¿ç”¨ ISO æ ‡å‡†å‘¨å·ï¼ˆå‘¨ä¸€ä¸ºä¸€å‘¨å¼€å§‹ï¼‰ã€‚
     - â€œæœ¬å‘¨â€ è¡¨ç¤ºå½“å‰æ—¥æœŸæ‰€åœ¨å‘¨å·ï¼š now.isocalendar().week
     - â€œä¸Šå‘¨â€ è¡¨ç¤ºå‰ä¸€å‘¨ï¼š (now - timedelta(weeks=1)).isocalendar().week
     - â€œä¸‹å‘¨â€ è¡¨ç¤ºåä¸€å‘¨ï¼š (now + timedelta(weeks=1)).isocalendar().week
     - å¹´ä»½åº”å¯¹åº”è¯¥å‘¨çš„ ISO å¹´ä»½ï¼š now.isocalendar().year
   - MONTH â†’ "YYYY-MM"
     - å¦‚æœè¾“å…¥ä¸­åªå‡ºç°æœˆä»½ï¼ˆå¦‚â€œ8æœˆä»½â€ã€â€œ9æœˆâ€ï¼‰ï¼Œåˆ™è¡¥ä¸Šå½“å‰å¹´ä»½ï¼Œä¾‹å¦‚ï¼š"2025-08"
     - å¦‚æœå‡ºç°â€œå»å¹´8æœˆä»½â€ï¼Œåˆ™ä½¿ç”¨å»å¹´å¹´ä»½ï¼š"2024-08"
     - å¦‚æœå‡ºç°â€œæ˜å¹´3æœˆä»½â€ï¼Œåˆ™ä½¿ç”¨æ˜å¹´å¹´ä»½ï¼š"2026-03"
     - å¦‚æœå‡ºç°â€œä¸Šä¸ªæœˆâ€ï¼Œåˆ™ä½¿ç”¨ä½¿ç”¨ä»Šå¹´å¹´ä»½ï¼š"2025-09"ï¼ˆå‡å¦‚è¿™ä¸ªæœˆæ˜¯2025å¹´10æœˆä»½ï¼‰
     - å¦‚æœè¾“å…¥ä¸­å‡ºç°â€œæœˆâ€åè·Ÿâ€œæ—¥â€ï¼Œä¾‹å¦‚â€œ10æœˆ14æ—¥â€ï¼Œåˆ™ä¼˜å…ˆåˆ¤æ–­ä¸º DAYï¼š
       è¾“å‡ºæ ¼å¼ï¼š{{"timeString":"YYYY-MM-DD","timeType":"DAY"}}
   - QUARTER â†’ "YYYY Q#"
   - TENDAYS â†’ "YYYY-MM ä¸Šæ—¬/ä¸­æ—¬/ä¸‹æ—¬"
   - YEAR â†’ "YYYY"
   è‹¥æ— æ³•æ¨ç®—åˆ™ä¸º nullã€‚

3. timeType å¿…é¡»æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š
   ["HOUR","SHIFT","DAY","WEEK","MONTH","QUARTER","TENDAYS","YEAR"]
   è‹¥æ— æ³•åˆ¤æ–­åˆ™ä¸º nullã€‚

4. æ”¯æŒç›¸å¯¹æ—¶é—´ï¼ˆä»Šå¤©ã€æ˜¨å¤©ã€ä¸Šå‘¨ã€ä¸Šæœˆã€ä»Šå¹´ã€å»å¹´ç­‰ï¼‰ï¼Œå¹¶åŸºäºå½“å‰æ—¶é—´ {now_str} æ¨ç®—ã€‚

5. ä½ è¿˜éœ€è¦æ”¯æŒåŒºé—´æ—¶é—´è¡¨è¾¾ï¼Œä¾‹å¦‚ï¼š
   - "10æœˆ1æ—¥åˆ°10æœˆ7æ—¥çš„å¨é’¢è’¸æ±½æ¶ˆè€—"
   - "2024-09-01~2024-09-07çº¯æ°´æŸå¤±ç‡"
   - "ä»ä¸Šå‘¨åˆ°æœ¬å‘¨çš„é«˜ç‚‰èƒ½è€—"
   - "ä»Šå¹´1æœˆåˆ°3æœˆå¨é’¢ç”¨æ°´é‡"
   åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š
   - indicator ä¸å˜ï¼›
   - timeString ç»Ÿä¸€è¾“å‡ºä¸º "å¼€å§‹æ—¶é—´~ç»“æŸæ—¶é—´"ï¼›
   - timeType ä¿æŒæœ€åˆé€‚çš„æ—¶é—´ç²’åº¦ï¼ˆå¦‚ DAYã€WEEKã€MONTHã€YEARï¼‰ã€‚

æ­¤å¤–ï¼Œè¿˜è¦æ”¯æŒâ€œæ¨¡ç³ŠåŒºé—´è¡¨è¾¾â€ï¼Œå³æœªæ˜ç¡®å‡ºç°â€˜åˆ°â€™ã€â€˜è‡³â€™ã€â€˜~â€™ä½†è¯­ä¹‰ä¸Šè¡¨ç¤ºåŒºé—´çš„æ—¶é—´çŸ­è¯­ã€‚
åŒ…æ‹¬ä½†ä¸é™äºï¼š
- â€œä¸€æœˆåˆ°ä¸‰æœˆâ€ã€â€œ1æœˆè‡³3æœˆâ€ã€â€œ1-3æœˆâ€ â†’ å½“å¹´åŒºé—´ "2025-01~2025-03"
- â€œå»å¹´ä¸€æœˆåˆ°ä¸‰æœˆâ€ â†’ å»å¹´åŒºé—´ "2024-01~2024-03"
- â€œä¸ŠåŠå¹´â€ â†’ å½“å¹´ä¸ŠåŠå¹´ "2025-01~2025-06"
- â€œä¸‹åŠå¹´â€ â†’ å½“å¹´ä¸‹åŠå¹´ "2025-07~2025-12"
è¿™äº›æ¨¡ç³ŠåŒºé—´ï¼š
1. ä¹Ÿå¿…é¡»ä»¥â€œå¼€å§‹~ç»“æŸâ€è¾“å‡ºï¼›
2. timeType é€šå¸¸ä¸º MONTHï¼›
3. è‹¥å‡ºç°â€œå»å¹´/æ˜å¹´â€ï¼Œåˆ™è°ƒæ•´å¹´ä»½ã€‚

è¯·ä¸¥æ ¼è¾“å‡º JSON, æ·»åŠ å¤šä½™æ–‡å­—ã€è§£é‡Šæˆ–æ³¨é‡Šã€‚

æ³¨æ„ï¼š
- â€œindicatorâ€ å¿…é¡»åªåŒ…å«æŒ‡æ ‡åç§°ï¼Œä¸åŒ…å«æ—¶é—´ç›¸å…³è¯ï¼ˆå¦‚â€œä»Šå¹´â€ã€â€œ9æœˆä»½â€ã€â€œæ˜¨å¤©â€ã€â€œä¸Šå‘¨â€ã€â€œç¬¬3å­£åº¦â€ç­‰ï¼‰ã€‚
- æŒ‡æ ‡ä¸­è‹¥åŒ…å«æ€§è´¨ä¿®é¥°ï¼ˆå¦‚â€œç´¯è®¡â€ã€â€œè®¡åˆ’â€ã€â€œç›®æ ‡â€ã€â€œç”¨é‡â€ã€â€œæˆæœ¬â€ã€â€œæ•ˆç‡â€ç­‰ï¼‰ï¼Œå¿…é¡»ä¿ç•™ã€‚
  ä¾‹å¦‚ï¼š
  - â€œæœ¬æœˆç´¯è®¡çš„é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘â€ â†’ indicator="é«˜ç‚‰å·¥åºèƒ½è€—ç´¯è®¡"
  - â€œé«˜ç‚‰å·¥åºèƒ½è€—æœ¬æœˆè®¡åˆ’æ˜¯å¤šå°‘â€ â†’ indicator="é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’"
  - â€œå»å¹´12æœˆå¨é’¢è’¸æ±½æˆæœ¬â€ â†’ indicator="å¨é’¢è’¸æ±½æˆæœ¬"
  - â€œæ˜å¹´ç›®æ ‡çº¯æ°´æŸå¤±ç‡â€ â†’ indicator="ç›®æ ‡çº¯æ°´æŸå¤±ç‡"
  - â€œ2022å¹´2æœˆ3æ—¥â€ â†’ indicator=null
- ç­æ¬¡è¯ï¼ˆæ—©ç­ã€ç™½ç­ã€å¤œç­ã€ä¸­ç­ã€æ™šç­ï¼‰å±äºæ—¶é—´ï¼Œä¸å±äºæŒ‡æ ‡ã€‚
- SHIFT ç±»å‹ä¼˜å…ˆäº HOURï¼šä¸è¦å°†â€œæ—©ç­â€é”™è¯¯åœ°è½¬åŒ–ä¸ºå…·ä½“å°æ—¶ã€‚
- åªæœ‰æ˜ç¡®ç¡®è®¤æè¿°çš„æ˜¯æ—¶é—´åŒºé—´æ‰ä½¿ç”¨åŒºé—´æ–¹å¼ï¼Œå¦åˆ™ä¸€å¾‹ä½¿ç”¨æ—¶é—´ç‚¹æ–¹å¼
  ä¾‹å¦‚ï¼š
  - â€œä»Šå¹´ç´¯è®¡çš„â€ â†’ indicator=nullã€timeString="2025"ã€timeType="YEAR"
  - â€œä¸Šå‘¨çš„â€ â†’ indicator=nullã€timeString="2025 W42"ã€timeType="WEEK"
- åŒºé—´æ˜¯åŒæ—¶è¯†åˆ«ä¸¤ä¸ªæ—¶é—´ï¼Œä¸­é—´ç”¨â€œ~â€æ‹¼æ¥ä½œä¸ºtimeStringï¼ŒtimeTypeä¸¥æ ¼æ‰§è¡Œå‰é¢æåˆ°çš„è§„åˆ™
  ä¾‹å¦‚ï¼š
  - â€œä¸€æœˆåˆ°ä¸‰æœˆçš„å¨é’¢è’¸æ±½æ¶ˆè€—â€ â†’ indicator="å¨é’¢è’¸æ±½æ¶ˆè€—"ã€timeString="2025-01~2025-03"ã€timeType="MONTH"
  - â€œä¸ŠåŠå¹´é«˜ç‚‰è®¡åˆ’â€ â†’ indicator="é«˜ç‚‰è®¡åˆ’"ã€timeString="2025-01~2025-06"ã€timeType="MONTH"


ç”¨æˆ·è¾“å…¥ï¼š"{user_input}"
"""

    llm = await get_llm()

    try:
        resp = await llm.agenerate([[HumanMessage(content=prompt)]])
        content = resp.generations[0][0].message.content.strip()
    except Exception as e:
        print("âŒ LLM è°ƒç”¨å¤±è´¥:", e)
        return {"indicator": None, "timeString": None, "timeType": None}

    try:
        result = json.loads(content)
    except json.JSONDecodeError:
        result = {
            "indicator": re.search(r'"indicator"\s*:\s*"([^"]*)"', content).group(1) if re.search(r'"indicator"\s*:\s*"([^"]*)"', content) else None,
            "timeString": re.search(r'"timeString"\s*:\s*"([^"]*)"', content).group(1) if re.search(r'"timeString"\s*:\s*"([^"]*)"', content) else None,
            "timeType": re.search(r'"timeType"\s*:\s*"([^"]*)"', content).group(1) if re.search(r'"timeType"\s*:\s*"([^"]*)"', content) else None
        }

    indicator = result.get("indicator")
    timeString = result.get("timeString")
    timeType = result.get("timeType")

    
    if indicator:
        indicator = re.sub(r'^(ä»Šå¤©|æ˜¨å¤©|æ˜å¤©|æœ¬å‘¨|ä¸Šå‘¨|ä¸‹å‘¨|ä¸Šæœˆ|æœ¬æœˆ|ä»Šå¹´|å»å¹´)\s*çš„?', '', indicator)
        indicator = re.sub(r'\s*(ä»Šå¤©|æ˜¨å¤©|æ˜å¤©|æœ¬å‘¨|ä¸Šå‘¨|ä¸‹å‘¨|ä¸Šæœˆ|æœ¬æœˆ|ä»Šå¹´|å»å¹´)$', '', indicator)
        indicator = indicator.strip() or None

    return {"indicator": indicator, "timeString": timeString, "timeType": timeType}


# ===================== æµ‹è¯• =====================
if __name__ == "__main__":
    import nest_asyncio
    nest_asyncio.apply()
    loop = asyncio.get_event_loop()
    now = datetime(2025, 10, 16, 14, 0)

    test_inputs = [
        "ä¸€æœˆåˆ°ä¸‰æœˆçš„å¨é’¢è’¸æ±½æ¶ˆè€—",
        "å»å¹´ä¸€æœˆåˆ°8æœˆå¨é’¢ç”¨æ°´é‡",
        "å»å¹´ä¸€ã€äºŒæœˆå¨é’¢ç”¨æ°´é‡",
        "ä¸ŠåŠå¹´è®¡åˆ’",
        "ä¸‹åŠå¹´çº¯æ°´æ¶ˆè€—",
        "2024å¹´9æœˆ1æ—¥åˆ°9æœˆ7æ—¥é«˜ç‚‰èƒ½è€—",
        "ä»Šå¤©çš„è¿é€€çº¯æ°´ä½¿ç”¨é‡",
        "2022å¹´10æœˆ2æ—¥",
        "450é…¸è½§çº¯æ°´ä½¿ç”¨é‡",
        "æŸ¥è¯¢ä»Šå¹´çš„2030é…¸è½§çº¯æ°´ä½¿ç”¨é‡",
        "ä»Šå¤©çš„é…¸è½§çº¯æ°´ä½¿ç”¨é‡",
        "9æœˆä»½çƒ­è½§è’¸æ±½æ¶ˆè€—",
        "é…¸è½§çº¯æ°´ä½¿ç”¨é‡",
        "æ˜¨å¤©",
        "2025å¹´ç¬¬41å‘¨çº¯æ°´æŸå¤±ç‡",
        "ä»Šå¹´10æœˆ14æ—¥é…¸è½§çº¯æ°´ä½¿ç”¨é‡",
        "æœ¬å‘¨",
        "ä¸Šå‘¨çš„å¨é’¢ç”¨æ°´é‡",
        "æ˜¨å¤©æ—©ç­çš„çƒ­è½§è’¸æ±½æ¶ˆè€—",
        "æ˜å¤©å‡Œæ™¨2ç‚¹çš„è½§åˆ¶æ°´è€—",
        "å»å¹´12æœˆä»½çš„å¨é’¢ç”¨æ°´é‡",
        "2025å¹´ç¬¬4å­£åº¦çº¯æ°´æŸå¤±ç‡",
        "2025å¹´10æœˆä¸Šæ—¬çƒ­è½§è’¸æ±½æ¶ˆè€—",
        "ä»Šå¤©çš„é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "é«˜ç‚‰ä»Šå¤©çš„å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "æœ¬æœˆç´¯è®¡çš„é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "1å·é«˜ç‚‰æ˜¨å¤©çš„å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "å»å¹´ä»Šå¤©çš„é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "2021å¹´10æœˆ23æ—¥çš„1é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "2023å¹´10æœˆ22æ—¥çš„2é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "æ—¶é—´ï¼š2021-10-23ï¼Œ1é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "æœ¬æœˆ1ã€2å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "é«˜ç‚‰å·¥åºèƒ½è€—æœ¬æœˆè®¡åˆ’æ˜¯å¤šå°‘",
        "æœ¬æœˆé«˜ç‚‰å·¥åºèƒ½è€—çš„è®¡åˆ’å€¼æ˜¯å¤šå°‘",
        "æœ¬æœˆçš„é«˜ç‚‰ç”µè€—æ˜¯å¤šå°‘",
        "æœ¬æœˆçš„é«˜ç‚‰ç”µä½¿ç”¨é‡æ˜¯å¤šå°‘",
        "é«˜ç‚‰çš„ç…¤æ°”è€—æ˜¯å¤šå°‘",
        "10å·é«˜ç‚‰ä»Šå¤©çš„å·¥åºèƒ½è€—æ˜¯å¤šå°‘",
        "ä»Šå¹´ç´¯è®¡çš„å†·è½§è’¸æ±½æ¶ˆè€—æ˜¯å¤šå°‘",
        "å‰å¤©æ™šç­çš„å¨é’¢ç”¨æ°´é‡"
    ]

    for ti in test_inputs:
        result = loop.run_until_complete(parse_user_input(ti))
        print(f"{ti} => {result}")

    # æµ‹è¯•ä¸€æ­¥å¯¹æ¯”
    reply, graph_state = await handle_compare(user_id, "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘", graph, {"candidates": ["2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—", "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’"]})
    print("Single Query Reply 1:", reply)
    print(json.dumps(graph_state, indent=2, ensure_ascii=False))
    
    # æµ‹è¯•é€‰æ‹©å¤‡é€‰
    reply, graph_state = await handle_clarify(user_id, 4, graph)
    print("Single Query Reply 2:", reply)
    print(json.dumps(graph_state, indent=2, ensure_ascii=False))

    # æµ‹è¯•é€‰æ‹©å¤‡é€‰
    reply, graph_state = await handle_single_query(user_id, "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼", graph)
    print("Single Query Reply 3:", reply)
    print(json.dumps(graph_state, indent=2, ensure_ascii=False))

(myenv) fusionshen@fusionshen-ThinkPad-T14-Gen-1:~/Desktop/LLM/ask_agent$ python -m core.pipeline_handlers
2025-11-16 15:42:55,639 | INFO | llm_client | âœ… Using ChatOllama from langchain-ollama
/home/fusionshen/myenv/lib/python3.12/site-packages/jieba/_compat.py:18: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
âœ… sentence-transformers ç‰ˆæœ¬: 5.1.1
<frozen runpy>:128: RuntimeWarning: 'core.pipeline_handlers' found in sys.modules after import of package 'core', but prior to execution of 'core.pipeline_handlers'; this may result in unpredictable behaviour
2025-11-16 15:42:58,922 | INFO | formula-api | ğŸ”„ æ­£åœ¨åˆå§‹åŒ–å…¬å¼æ•°æ®ï¼ˆfull loadï¼‰...
Building prefix dict from the default dictionary ...
2025-11-16 15:43:02,268 | DEBUG | jieba | Building prefix dict from the default dictionary ...
Loading model from cache /tmp/jieba.cache
2025-11-16 15:43:02,269 | DEBUG | jieba | Loading model from cache /tmp/jieba.cache
Loading model cost 0.602 seconds.
2025-11-16 15:43:02,871 | DEBUG | jieba | Loading model cost 0.602 seconds.
Prefix dict has been built successfully.
2025-11-16 15:43:02,871 | DEBUG | jieba | Prefix dict has been built successfully.
2025-11-16 15:43:16,398 | INFO | formula-api | âœ… Loaded 270817 formulas. Tokenization ready.
HAVE_ST : True
2025-11-16 15:43:16,404 | INFO | formula-api | Auto-selected embedding device: cpu
OFFLINE_MODEL_PATH:/home/fusionshen/Desktop/LLM/ask_agent/models/sbert_offline_models/86741b4e3f5cb7765a600d3a3d55a0f6a6cb443d
2025-11-16 15:43:16,405 | INFO | formula-api | ğŸ§© å°è¯•åŠ è½½æœ¬åœ°æ¨¡å‹: /home/fusionshen/Desktop/LLM/ask_agent/models/sbert_offline_models/86741b4e3f5cb7765a600d3a3d55a0f6a6cb443d
2025-11-16 15:43:16,406 | INFO | sentence_transformers.SentenceTransformer | Load pretrained SentenceTransformer: /home/fusionshen/Desktop/LLM/ask_agent/models/sbert_offline_models/86741b4e3f5cb7765a600d3a3d55a0f6a6cb443d
2025-11-16 15:43:17,366 | INFO | formula-api | âœ… å·²æˆåŠŸåŠ è½½ç¦»çº¿æ¨¡å‹ã€‚
2025-11-16 15:43:17,988 | INFO | formula-api | âœ… Loaded embeddings from cache ((270817, 384))
2025-11-16 15:43:17,988 | INFO | formula-api | âœ… åˆå§‹åŒ–å®Œæˆï¼Œç”¨æ—¶ 19.07s
2025-11-16 15:43:17,988 | INFO | pipeline.handlers | ğŸ”€ è¿›å…¥ handle_compareï¼Œuser=test_user, input=2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘
âš ï¸ æ— èŠ‚ç‚¹å¯æ¢å¤ intent_info
2025-11-16 15:43:17,988 | INFO | pipeline.handlers | ğŸ” compare: ä½¿ç”¨ candidates è§£æ: ['2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—', '2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’']
2025-11-16 15:43:18,090 | INFO | httpx | HTTP Request: GET http://10.8.0.178:11434/api/tags "HTTP/1.1 200 OK"
2025-11-16 15:43:26,601 | INFO | httpx | HTTP Request: POST http://10.8.0.178:11434/api/chat "HTTP/1.1 200 OK"
```json
{
  "indicator": "1å·é«˜ç‚‰å·¥åºèƒ½è€—",
  "timeString": "2022",
  "timeType": "YEAR"
}
```
2025-11-16 15:43:27,771 | INFO | llm_client | âœ… ä» LLM è¾“å‡ºä¸­æˆåŠŸè§£æ JSONã€‚
2025-11-16 15:43:27,879 | INFO | httpx | HTTP Request: GET http://10.8.0.178:11434/api/tags "HTTP/1.1 200 OK"
2025-11-16 15:43:29,025 | INFO | httpx | HTTP Request: POST http://10.8.0.178:11434/api/chat "HTTP/1.1 200 OK"
```json
{
  "indicator": "1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’",
  "timeString": "2022",
  "timeType": "YEAR"
}
```
2025-11-16 15:43:30,221 | INFO | llm_client | âœ… ä» LLM è¾“å‡ºä¸­æˆåŠŸè§£æ JSONã€‚
Batches: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1/1 [00:00<00:00,  5.64it/s]
2025-11-16 15:43:31,281 | INFO | context_graph | ğŸ•˜ add_history: 2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘ -> æ²¡æœ‰å®Œå…¨åŒ¹é…çš„[1å·é«˜ç‚‰å·¥åºèƒ½è€—]æŒ‡æ ‡ï¼Œè¯·ä»ä»¥ä¸‹å€™é€‰é€‰æ‹©ç¼–å·(æˆ–è€…é‡æ–°è¾“å…¥å°½é‡ç²¾ç¡®çš„æŒ‡æ ‡åç§°ï¼š
1) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 91.78)
2) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼ (score 88.66)
3) 1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 88.46)
4) 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (score 87.77)
5) é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (score 87.20)
Single Query Reply 1: æ²¡æœ‰å®Œå…¨åŒ¹é…çš„[1å·é«˜ç‚‰å·¥åºèƒ½è€—]æŒ‡æ ‡ï¼Œè¯·ä»ä»¥ä¸‹å€™é€‰é€‰æ‹©ç¼–å·(æˆ–è€…é‡æ–°è¾“å…¥å°½é‡ç²¾ç¡®çš„æŒ‡æ ‡åç§°ï¼š
1) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 91.78)
2) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼ (score 88.66)
3) 1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 88.46)
4) 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (score 87.77)
5) é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (score 87.20)
{
  "graph": {
    "nodes": [],
    "relations": [],
    "_next_id": 1
  },
  "meta": {
    "history": [
      {
        "ask": "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘",
        "reply": "æ²¡æœ‰å®Œå…¨åŒ¹é…çš„[1å·é«˜ç‚‰å·¥åºèƒ½è€—]æŒ‡æ ‡ï¼Œè¯·ä»ä»¥ä¸‹å€™é€‰é€‰æ‹©ç¼–å·(æˆ–è€…é‡æ–°è¾“å…¥å°½é‡ç²¾ç¡®çš„æŒ‡æ ‡åç§°ï¼š\n1) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 91.78)\n2) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼ (score 88.66)\n3) 1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 88.46)\n4) 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (score 87.77)\n5) é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (score 87.20)"
      }
    ],
    "current_intent_info": {
      "user_input_list": [
        "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘"
      ],
      "intent_list": [
        "compare"
      ],
      "indicators": [
        {
          "status": "active",
          "indicator": "1å·é«˜ç‚‰å·¥åºèƒ½è€—",
          "formula": null,
          "timeString": "2022",
          "timeType": "YEAR",
          "slot_status": {
            "formula": "missing",
            "time": "filled"
          },
          "value": null,
          "note": null,
          "formula_candidates": [
            {
              "number": 1,
              "FORMULAID": "GXNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 91.7787,
              "fuzzy_score": 95.4909,
              "semantic_score": 81.9644,
              "match_kind": "hybrid"
            },
            {
              "number": 2,
              "FORMULAID": "GXNHLT1101.IXPL.SUMVALUE",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼",
              "score": 88.6605,
              "fuzzy_score": 92.6545,
              "semantic_score": 83.2141,
              "match_kind": "hybrid"
            },
            {
              "number": 3,
              "FORMULAID": "PHNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 88.4603,
              "fuzzy_score": 95.4909,
              "semantic_score": 76.6991,
              "match_kind": "hybrid"
            },
            {
              "number": 4,
              "FORMULAID": "GXNHLT1101.IXRL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "score": 87.768,
              "fuzzy_score": 99.1636,
              "semantic_score": 67.9943,
              "match_kind": "hybrid"
            },
            {
              "number": 5,
              "FORMULAID": "GXNHLT1100.IXRL",
              "FORMULANAME": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "score": 87.2049,
              "fuzzy_score": 87.264,
              "semantic_score": 75.0671,
              "match_kind": "hybrid"
            }
          ]
        },
        {
          "status": "active",
          "indicator": "1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’",
          "formula": null,
          "timeString": "2022",
          "timeType": "YEAR",
          "slot_status": {
            "formula": "missing",
            "time": "filled"
          },
          "value": null,
          "note": null,
          "formula_candidates": null
        }
      ]
    }
  }
}
2025-11-16 15:43:31,281 | INFO | pipeline.handlers | âœ… è¿›å…¥ clarify æ¨¡å¼ã€‚
2025-11-16 15:43:31,281 | INFO | pipeline.handlers | ğŸ”¹ handle_clarify user_input=4
2025-11-16 15:43:31,281 | INFO | pipeline.handlers | ğŸ”¢ æ£€æµ‹åˆ°å€™é€‰é€‰æ‹© index=3, count=5
2025-11-16 15:43:31,281 | INFO | pipeline.handlers | âœ… ç”¨æˆ·é€‰æ‹©å…¬å¼: 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (FORMULAID=GXNHLT1101.IXRL)
ğŸŸ¢ ç™»å½•è¿”å›ï¼š {'error': None, 'data': {'token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiIxNDMiLCJ0ZW5hbnRpZCI6IjEwNSIsInVuYW1lIjoi566h55CG5ZGYIiwidG5hbWUiOiLlrp3pkqLmuZvmsZ_pkqLpk4HmnInpmZDlhazlj7giLCJ0c2lkZSI6IjEiLCJncm91cGlkIjoiMCIsInNsaWRpbmciOiIwIiwicnNpbmNlIjoiMTc2MzQyMjcxMSIsIm5iZiI6MTc2MzI3ODQxMSwiZXhwIjoxNzYzMzk0MjExLCJpc3MiOiJzaGJhb25lbmciLCJhdWQiOiJzaGJhb25lbmcifQ.5LygfBdo1NCjNiw87mtzdO3BOIxOmCfOgrYwaHeNU-A', 'expiresAt': '2025-11-17 23:42:31', 'tenantId': 105, 'tenancyName': 'zjis', 'userId': 143, 'userName': 'admin'}, 'status': 200, 'msg': 'æ“ä½œæˆåŠŸ', 'duration': -1}
ğŸŸ¡ è°ƒç”¨æ¥å£: http://www.shbaoenergy.com:8081/emscore/api/services/nYMC/calcData/QueryItemValuesAsync
ğŸ§© è¯·æ±‚å‚æ•°: {'expressionList': {'GXNHLT1101.IXRL': 'GXNHLT1101.IXRL'}, 'clock': '2022', 'timegranId': 'YEAR'}
ğŸŸ¢ è¿”å›æ•°æ®: {'error': None, 'data': {'GXNHLT1101.IXRL': '0'}, 'status': 200, 'msg': 'æ“ä½œæˆåŠŸ', 'duration': -1}
2025-11-16 15:43:31,509 | INFO | pipeline.handlers | âš™ï¸ å¹³å°æŸ¥è¯¢æˆåŠŸ: {'GXNHLT1101.IXRL': '0'}
2025-11-16 15:43:31,509 | INFO | context_graph | ğŸ†• ContextGraph.add_node -> id=1, indicator=1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼, time=2022
2025-11-16 15:43:31,509 | INFO | pipeline.handlers | ğŸ”„ clarify å®Œæˆå¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...
current_intents:['1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’']
2025-11-16 15:43:31,509 | INFO | pipeline.handlers | ğŸ”€ è¿›å…¥ handle_compareï¼Œuser=test_user, input=4 -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...
2025-11-16 15:43:31,509 | INFO | pipeline.handlers | ğŸ” compare: single candidate æƒ…å½¢ -> two-step flow
2025-11-16 15:43:31,599 | INFO | httpx | HTTP Request: GET http://10.8.0.178:11434/api/tags "HTTP/1.1 200 OK"
2025-11-16 15:43:32,738 | INFO | httpx | HTTP Request: POST http://10.8.0.178:11434/api/chat "HTTP/1.1 200 OK"
```json
{
  "indicator": "1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’",
  "timeString": null,
  "timeType": null
}
```
2025-11-16 15:43:33,774 | INFO | llm_client | âœ… ä» LLM è¾“å‡ºä¸­æˆåŠŸè§£æ JSONã€‚
1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’
Batches: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1/1 [00:00<00:00, 42.21it/s]
{'done': False, 'candidates': [{'number': 1, 'FORMULAID': 'GXNHLT1101.IXPL', 'FORMULANAME': '1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼', 'score': 93.7797, 'fuzzy_score': 97.5371, 'semantic_score': 83.7753, 'match_kind': 'hybrid'}, {'number': 2, 'FORMULAID': 'GXNHLT1100.IXPL', 'FORMULANAME': 'é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼', 'score': 90.6642, 'fuzzy_score': 88.88, 'semantic_score': 84.6033, 'match_kind': 'hybrid'}, {'number': 3, 'FORMULAID': 'PHNHLT1101.IXPL', 'FORMULANAME': '1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼', 'score': 90.4736, 'fuzzy_score': 97.5371, 'semantic_score': 78.5294, 'match_kind': 'hybrid'}, {'number': 4, 'FORMULAID': 'GXNHLT1101.IXPL.SUMVALUE', 'FORMULANAME': '1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼', 'score': 90.0906, 'fuzzy_score': 94.64, 'semantic_score': 84.229, 'match_kind': 'hybrid'}, {'number': 5, 'FORMULAID': 'GXNHLT1102.IXPL', 'FORMULANAME': '2é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼', 'score': 87.1809, 'fuzzy_score': 88.88, 'semantic_score': 79.0764, 'match_kind': 'hybrid'}]}
2025-11-16 15:43:34,632 | INFO | context_graph | ğŸ•˜ add_history: 4 -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare... -> æ²¡æœ‰å®Œå…¨åŒ¹é…çš„[1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’]æŒ‡æ ‡ï¼Œè¯·ä»ä»¥ä¸‹å€™é€‰é€‰æ‹©ç¼–å·(æˆ–è€…é‡æ–°è¾“å…¥å°½é‡ç²¾ç¡®çš„æŒ‡æ ‡åç§°ï¼š
1) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 93.78)
2) é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 90.66)
3) 1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 90.47)
4) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼ (score 90.09)
5) 2é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 87.18)
Single Query Reply 2: æ²¡æœ‰å®Œå…¨åŒ¹é…çš„[1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’]æŒ‡æ ‡ï¼Œè¯·ä»ä»¥ä¸‹å€™é€‰é€‰æ‹©ç¼–å·(æˆ–è€…é‡æ–°è¾“å…¥å°½é‡ç²¾ç¡®çš„æŒ‡æ ‡åç§°ï¼š
1) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 93.78)
2) é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 90.66)
3) 1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 90.47)
4) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼ (score 90.09)
5) 2é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 87.18)
{
  "graph": {
    "nodes": [
      {
        "id": 1,
        "indicator_entry": {
          "status": "completed",
          "indicator": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
          "formula": "GXNHLT1101.IXRL",
          "timeString": "2022",
          "timeType": "YEAR",
          "slot_status": {
            "formula": "filled",
            "time": "filled"
          },
          "value": "0",
          "note": "âœ… 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ åœ¨ 2022 (YEAR) çš„å€¼æ˜¯ 0 ",
          "formula_candidates": [
            {
              "number": 1,
              "FORMULAID": "GXNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 91.7787,
              "fuzzy_score": 95.4909,
              "semantic_score": 81.9644,
              "match_kind": "hybrid"
            },
            {
              "number": 2,
              "FORMULAID": "GXNHLT1101.IXPL.SUMVALUE",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼",
              "score": 88.6605,
              "fuzzy_score": 92.6545,
              "semantic_score": 83.2141,
              "match_kind": "hybrid"
            },
            {
              "number": 3,
              "FORMULAID": "PHNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 88.4603,
              "fuzzy_score": 95.4909,
              "semantic_score": 76.6991,
              "match_kind": "hybrid"
            },
            {
              "number": 4,
              "FORMULAID": "GXNHLT1101.IXRL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "score": 87.768,
              "fuzzy_score": 99.1636,
              "semantic_score": 67.9943,
              "match_kind": "hybrid"
            },
            {
              "number": 5,
              "FORMULAID": "GXNHLT1100.IXRL",
              "FORMULANAME": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "score": 87.2049,
              "fuzzy_score": 87.264,
              "semantic_score": 75.0671,
              "match_kind": "hybrid"
            }
          ]
        },
        "intent_info_snapshot": {
          "user_input_list": [
            "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘",
            "4"
          ],
          "intent_list": [
            "compare",
            "clarify"
          ],
          "indicators": [
            {
              "status": "completed",
              "indicator": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "formula": "GXNHLT1101.IXRL",
              "timeString": "2022",
              "timeType": "YEAR",
              "slot_status": {
                "formula": "filled",
                "time": "filled"
              },
              "value": "0",
              "note": "âœ… 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ åœ¨ 2022 (YEAR) çš„å€¼æ˜¯ 0 ",
              "formula_candidates": [
                {
                  "number": 1,
                  "FORMULAID": "GXNHLT1101.IXPL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
                  "score": 91.7787,
                  "fuzzy_score": 95.4909,
                  "semantic_score": 81.9644,
                  "match_kind": "hybrid"
                },
                {
                  "number": 2,
                  "FORMULAID": "GXNHLT1101.IXPL.SUMVALUE",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼",
                  "score": 88.6605,
                  "fuzzy_score": 92.6545,
                  "semantic_score": 83.2141,
                  "match_kind": "hybrid"
                },
                {
                  "number": 3,
                  "FORMULAID": "PHNHLT1101.IXPL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
                  "score": 88.4603,
                  "fuzzy_score": 95.4909,
                  "semantic_score": 76.6991,
                  "match_kind": "hybrid"
                },
                {
                  "number": 4,
                  "FORMULAID": "GXNHLT1101.IXRL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
                  "score": 87.768,
                  "fuzzy_score": 99.1636,
                  "semantic_score": 67.9943,
                  "match_kind": "hybrid"
                },
                {
                  "number": 5,
                  "FORMULAID": "GXNHLT1100.IXRL",
                  "FORMULANAME": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
                  "score": 87.2049,
                  "fuzzy_score": 87.264,
                  "semantic_score": 75.0671,
                  "match_kind": "hybrid"
                }
              ]
            },
            {
              "status": "active",
              "indicator": "1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’",
              "formula": null,
              "timeString": "2022",
              "timeType": "YEAR",
              "slot_status": {
                "formula": "missing",
                "time": "filled"
              },
              "value": null,
              "note": null,
              "formula_candidates": null
            }
          ]
        }
      }
    ],
    "relations": [],
    "_next_id": 2
  },
  "meta": {
    "history": [
      {
        "ask": "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘",
        "reply": "æ²¡æœ‰å®Œå…¨åŒ¹é…çš„[1å·é«˜ç‚‰å·¥åºèƒ½è€—]æŒ‡æ ‡ï¼Œè¯·ä»ä»¥ä¸‹å€™é€‰é€‰æ‹©ç¼–å·(æˆ–è€…é‡æ–°è¾“å…¥å°½é‡ç²¾ç¡®çš„æŒ‡æ ‡åç§°ï¼š\n1) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 91.78)\n2) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼ (score 88.66)\n3) 1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 88.46)\n4) 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (score 87.77)\n5) é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (score 87.20)"
      },
      {
        "ask": "4 -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...",
        "reply": "æ²¡æœ‰å®Œå…¨åŒ¹é…çš„[1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’]æŒ‡æ ‡ï¼Œè¯·ä»ä»¥ä¸‹å€™é€‰é€‰æ‹©ç¼–å·(æˆ–è€…é‡æ–°è¾“å…¥å°½é‡ç²¾ç¡®çš„æŒ‡æ ‡åç§°ï¼š\n1) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 93.78)\n2) é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 90.66)\n3) 1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 90.47)\n4) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼ (score 90.09)\n5) 2é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 87.18)"
      }
    ],
    "current_intent_info": {
      "user_input_list": [
        "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘",
        "4",
        "4 -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare..."
      ],
      "intent_list": [
        "compare",
        "clarify",
        "compare"
      ],
      "indicators": [
        {
          "status": "completed",
          "indicator": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
          "formula": "GXNHLT1101.IXRL",
          "timeString": "2022",
          "timeType": "YEAR",
          "slot_status": {
            "formula": "filled",
            "time": "filled"
          },
          "value": "0",
          "note": "âœ… 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ åœ¨ 2022 (YEAR) çš„å€¼æ˜¯ 0 ",
          "formula_candidates": [
            {
              "number": 1,
              "FORMULAID": "GXNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 91.7787,
              "fuzzy_score": 95.4909,
              "semantic_score": 81.9644,
              "match_kind": "hybrid"
            },
            {
              "number": 2,
              "FORMULAID": "GXNHLT1101.IXPL.SUMVALUE",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼",
              "score": 88.6605,
              "fuzzy_score": 92.6545,
              "semantic_score": 83.2141,
              "match_kind": "hybrid"
            },
            {
              "number": 3,
              "FORMULAID": "PHNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 88.4603,
              "fuzzy_score": 95.4909,
              "semantic_score": 76.6991,
              "match_kind": "hybrid"
            },
            {
              "number": 4,
              "FORMULAID": "GXNHLT1101.IXRL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "score": 87.768,
              "fuzzy_score": 99.1636,
              "semantic_score": 67.9943,
              "match_kind": "hybrid"
            },
            {
              "number": 5,
              "FORMULAID": "GXNHLT1100.IXRL",
              "FORMULANAME": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "score": 87.2049,
              "fuzzy_score": 87.264,
              "semantic_score": 75.0671,
              "match_kind": "hybrid"
            }
          ]
        },
        {
          "status": "active",
          "indicator": "1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’",
          "formula": null,
          "timeString": "2022",
          "timeType": "YEAR",
          "slot_status": {
            "formula": "missing",
            "time": "filled"
          },
          "value": null,
          "note": null,
          "formula_candidates": [
            {
              "number": 1,
              "FORMULAID": "GXNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 93.7797,
              "fuzzy_score": 97.5371,
              "semantic_score": 83.7753,
              "match_kind": "hybrid"
            },
            {
              "number": 2,
              "FORMULAID": "GXNHLT1100.IXPL",
              "FORMULANAME": "é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 90.6642,
              "fuzzy_score": 88.88,
              "semantic_score": 84.6033,
              "match_kind": "hybrid"
            },
            {
              "number": 3,
              "FORMULAID": "PHNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 90.4736,
              "fuzzy_score": 97.5371,
              "semantic_score": 78.5294,
              "match_kind": "hybrid"
            },
            {
              "number": 4,
              "FORMULAID": "GXNHLT1101.IXPL.SUMVALUE",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼",
              "score": 90.0906,
              "fuzzy_score": 94.64,
              "semantic_score": 84.229,
              "match_kind": "hybrid"
            },
            {
              "number": 5,
              "FORMULAID": "GXNHLT1102.IXPL",
              "FORMULANAME": "2é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 87.1809,
              "fuzzy_score": 88.88,
              "semantic_score": 79.0764,
              "match_kind": "hybrid"
            }
          ]
        }
      ]
    }
  }
}
2025-11-16 15:43:34,633 | INFO | pipeline.handlers | âœ… è¿›å…¥ single query æ¨¡å¼ã€‚
2025-11-16 15:43:34,633 | INFO | pipeline.handlers | ğŸ”¹ handle_single_query user_input=é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼
2025-11-16 15:43:34,746 | INFO | httpx | HTTP Request: GET http://10.8.0.178:11434/api/tags "HTTP/1.1 200 OK"
2025-11-16 15:43:35,828 | INFO | httpx | HTTP Request: POST http://10.8.0.178:11434/api/chat "HTTP/1.1 200 OK"
```json
{
  "indicator": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
  "timeString": null,
  "timeType": null
}
```
2025-11-16 15:43:36,928 | INFO | llm_client | âœ… ä» LLM è¾“å‡ºä¸­æˆåŠŸè§£æ JSONã€‚
ğŸŸ¡ è°ƒç”¨æ¥å£: http://www.shbaoenergy.com:8081/emscore/api/services/nYMC/calcData/QueryItemValuesAsync
ğŸ§© è¯·æ±‚å‚æ•°: {'expressionList': {'GXNHLT1100.IXRL': 'GXNHLT1100.IXRL'}, 'clock': '2022', 'timegranId': 'YEAR'}
ğŸŸ¢ è¿”å›æ•°æ®: {'error': None, 'data': {'GXNHLT1100.IXRL': '248.1'}, 'status': 200, 'msg': 'æ“ä½œæˆåŠŸ', 'duration': -1}
2025-11-16 15:43:37,077 | INFO | pipeline.handlers | âš™ï¸ å¹³å°æŸ¥è¯¢æˆåŠŸ: {'GXNHLT1100.IXRL': '248.1'}
2025-11-16 15:43:37,077 | INFO | context_graph | ğŸ†• ContextGraph.add_node -> id=2, indicator=é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼, time=2022
2025-11-16 15:43:37,077 | INFO | pipeline.handlers | ğŸ”„ clarify å®Œæˆå¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...
current_intents:[]
2025-11-16 15:43:37,077 | INFO | pipeline.handlers | ğŸ”€ è¿›å…¥ handle_compareï¼Œuser=test_user, input=é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...
2025-11-16 15:43:37,078 | INFO | pipeline.handlers | ğŸ” compare: æœªæä¾› candidatesï¼Œå°è¯•ä» graph å›æº¯æœ€è¿‘ä¸¤ä¸ªèŠ‚ç‚¹
2025-11-16 15:43:37,185 | INFO | httpx | HTTP Request: GET http://10.8.0.178:11434/api/tags "HTTP/1.1 200 OK"
2025-11-16 15:43:37,587 | INFO | httpx | HTTP Request: POST http://10.8.0.178:11434/api/chat "HTTP/1.1 200 OK"
2025-11-16 15:43:38,716 | INFO | llm.indicator.compare | ğŸ” compare LLM è¾“å‡º: 2022å¹´ï¼Œé«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ä¸1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ç›¸å·®248.1ï¼Œåè€…æ•°å€¼ä¸º0ã€‚
2025-11-16 15:43:38,716 | INFO | context_graph | ğŸ”— ContextGraph.add_relation: compare (source=1 target=2) meta={'via': 'pipeline.compare', 'user_input': ['2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘', '4', '4 -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...', 'é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼', 'é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...'], 'result': '2022å¹´ï¼Œé«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ä¸1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ç›¸å·®248.1ï¼Œåè€…æ•°å€¼ä¸º0ã€‚'}
2025-11-16 15:43:38,716 | INFO | context_graph | ğŸ•˜ add_history: é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare... -> 2022å¹´ï¼Œé«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ä¸1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ç›¸å·®248.1ï¼Œåè€…æ•°å€¼ä¸º0ã€‚
2025-11-16 15:43:38,716 | INFO | pipeline.handlers | âœ… compare(three-step) å®Œæˆ
Single Query Reply 3: 2022å¹´ï¼Œé«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ä¸1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ç›¸å·®248.1ï¼Œåè€…æ•°å€¼ä¸º0ã€‚
{
  "graph": {
    "nodes": [
      {
        "id": 1,
        "indicator_entry": {
          "status": "completed",
          "indicator": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
          "formula": "GXNHLT1101.IXRL",
          "timeString": "2022",
          "timeType": "YEAR",
          "slot_status": {
            "formula": "filled",
            "time": "filled"
          },
          "value": "0",
          "note": "âœ… 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ åœ¨ 2022 (YEAR) çš„å€¼æ˜¯ 0 ",
          "formula_candidates": [
            {
              "number": 1,
              "FORMULAID": "GXNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 91.7787,
              "fuzzy_score": 95.4909,
              "semantic_score": 81.9644,
              "match_kind": "hybrid"
            },
            {
              "number": 2,
              "FORMULAID": "GXNHLT1101.IXPL.SUMVALUE",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼",
              "score": 88.6605,
              "fuzzy_score": 92.6545,
              "semantic_score": 83.2141,
              "match_kind": "hybrid"
            },
            {
              "number": 3,
              "FORMULAID": "PHNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 88.4603,
              "fuzzy_score": 95.4909,
              "semantic_score": 76.6991,
              "match_kind": "hybrid"
            },
            {
              "number": 4,
              "FORMULAID": "GXNHLT1101.IXRL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "score": 87.768,
              "fuzzy_score": 99.1636,
              "semantic_score": 67.9943,
              "match_kind": "hybrid"
            },
            {
              "number": 5,
              "FORMULAID": "GXNHLT1100.IXRL",
              "FORMULANAME": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "score": 87.2049,
              "fuzzy_score": 87.264,
              "semantic_score": 75.0671,
              "match_kind": "hybrid"
            }
          ]
        },
        "intent_info_snapshot": {
          "user_input_list": [
            "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘",
            "4"
          ],
          "intent_list": [
            "compare",
            "clarify"
          ],
          "indicators": [
            {
              "status": "completed",
              "indicator": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "formula": "GXNHLT1101.IXRL",
              "timeString": "2022",
              "timeType": "YEAR",
              "slot_status": {
                "formula": "filled",
                "time": "filled"
              },
              "value": "0",
              "note": "âœ… 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ åœ¨ 2022 (YEAR) çš„å€¼æ˜¯ 0 ",
              "formula_candidates": [
                {
                  "number": 1,
                  "FORMULAID": "GXNHLT1101.IXPL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
                  "score": 91.7787,
                  "fuzzy_score": 95.4909,
                  "semantic_score": 81.9644,
                  "match_kind": "hybrid"
                },
                {
                  "number": 2,
                  "FORMULAID": "GXNHLT1101.IXPL.SUMVALUE",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼",
                  "score": 88.6605,
                  "fuzzy_score": 92.6545,
                  "semantic_score": 83.2141,
                  "match_kind": "hybrid"
                },
                {
                  "number": 3,
                  "FORMULAID": "PHNHLT1101.IXPL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
                  "score": 88.4603,
                  "fuzzy_score": 95.4909,
                  "semantic_score": 76.6991,
                  "match_kind": "hybrid"
                },
                {
                  "number": 4,
                  "FORMULAID": "GXNHLT1101.IXRL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
                  "score": 87.768,
                  "fuzzy_score": 99.1636,
                  "semantic_score": 67.9943,
                  "match_kind": "hybrid"
                },
                {
                  "number": 5,
                  "FORMULAID": "GXNHLT1100.IXRL",
                  "FORMULANAME": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
                  "score": 87.2049,
                  "fuzzy_score": 87.264,
                  "semantic_score": 75.0671,
                  "match_kind": "hybrid"
                }
              ]
            },
            {
              "status": "active",
              "indicator": "1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’",
              "formula": null,
              "timeString": "2022",
              "timeType": "YEAR",
              "slot_status": {
                "formula": "missing",
                "time": "filled"
              },
              "value": null,
              "note": null,
              "formula_candidates": null
            }
          ]
        }
      },
      {
        "id": 2,
        "indicator_entry": {
          "status": "completed",
          "indicator": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
          "formula": "GXNHLT1100.IXRL",
          "timeString": "2022",
          "timeType": "YEAR",
          "slot_status": {
            "formula": "filled",
            "time": "filled"
          },
          "value": "248.1",
          "note": "âœ… é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ åœ¨ 2022 (YEAR) çš„å€¼æ˜¯ 248.1 ",
          "formula_candidates": [
            {
              "number": 1,
              "FORMULAID": "GXNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 93.7797,
              "fuzzy_score": 97.5371,
              "semantic_score": 83.7753,
              "match_kind": "hybrid"
            },
            {
              "number": 2,
              "FORMULAID": "GXNHLT1100.IXPL",
              "FORMULANAME": "é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 90.6642,
              "fuzzy_score": 88.88,
              "semantic_score": 84.6033,
              "match_kind": "hybrid"
            },
            {
              "number": 3,
              "FORMULAID": "PHNHLT1101.IXPL",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 90.4736,
              "fuzzy_score": 97.5371,
              "semantic_score": 78.5294,
              "match_kind": "hybrid"
            },
            {
              "number": 4,
              "FORMULAID": "GXNHLT1101.IXPL.SUMVALUE",
              "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼",
              "score": 90.0906,
              "fuzzy_score": 94.64,
              "semantic_score": 84.229,
              "match_kind": "hybrid"
            },
            {
              "number": 5,
              "FORMULAID": "GXNHLT1102.IXPL",
              "FORMULANAME": "2é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
              "score": 87.1809,
              "fuzzy_score": 88.88,
              "semantic_score": 79.0764,
              "match_kind": "hybrid"
            }
          ]
        },
        "intent_info_snapshot": {
          "user_input_list": [
            "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘",
            "4",
            "4 -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...",
            "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼"
          ],
          "intent_list": [
            "compare",
            "clarify",
            "compare",
            "single_query"
          ],
          "indicators": [
            {
              "status": "completed",
              "indicator": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "formula": "GXNHLT1101.IXRL",
              "timeString": "2022",
              "timeType": "YEAR",
              "slot_status": {
                "formula": "filled",
                "time": "filled"
              },
              "value": "0",
              "note": "âœ… 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ åœ¨ 2022 (YEAR) çš„å€¼æ˜¯ 0 ",
              "formula_candidates": [
                {
                  "number": 1,
                  "FORMULAID": "GXNHLT1101.IXPL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
                  "score": 91.7787,
                  "fuzzy_score": 95.4909,
                  "semantic_score": 81.9644,
                  "match_kind": "hybrid"
                },
                {
                  "number": 2,
                  "FORMULAID": "GXNHLT1101.IXPL.SUMVALUE",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼",
                  "score": 88.6605,
                  "fuzzy_score": 92.6545,
                  "semantic_score": 83.2141,
                  "match_kind": "hybrid"
                },
                {
                  "number": 3,
                  "FORMULAID": "PHNHLT1101.IXPL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
                  "score": 88.4603,
                  "fuzzy_score": 95.4909,
                  "semantic_score": 76.6991,
                  "match_kind": "hybrid"
                },
                {
                  "number": 4,
                  "FORMULAID": "GXNHLT1101.IXRL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
                  "score": 87.768,
                  "fuzzy_score": 99.1636,
                  "semantic_score": 67.9943,
                  "match_kind": "hybrid"
                },
                {
                  "number": 5,
                  "FORMULAID": "GXNHLT1100.IXRL",
                  "FORMULANAME": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
                  "score": 87.2049,
                  "fuzzy_score": 87.264,
                  "semantic_score": 75.0671,
                  "match_kind": "hybrid"
                }
              ]
            },
            {
              "status": "completed",
              "indicator": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
              "formula": "GXNHLT1100.IXRL",
              "timeString": "2022",
              "timeType": "YEAR",
              "slot_status": {
                "formula": "filled",
                "time": "filled"
              },
              "value": "248.1",
              "note": "âœ… é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ åœ¨ 2022 (YEAR) çš„å€¼æ˜¯ 248.1 ",
              "formula_candidates": [
                {
                  "number": 1,
                  "FORMULAID": "GXNHLT1101.IXPL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
                  "score": 93.7797,
                  "fuzzy_score": 97.5371,
                  "semantic_score": 83.7753,
                  "match_kind": "hybrid"
                },
                {
                  "number": 2,
                  "FORMULAID": "GXNHLT1100.IXPL",
                  "FORMULANAME": "é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
                  "score": 90.6642,
                  "fuzzy_score": 88.88,
                  "semantic_score": 84.6033,
                  "match_kind": "hybrid"
                },
                {
                  "number": 3,
                  "FORMULAID": "PHNHLT1101.IXPL",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
                  "score": 90.4736,
                  "fuzzy_score": 97.5371,
                  "semantic_score": 78.5294,
                  "match_kind": "hybrid"
                },
                {
                  "number": 4,
                  "FORMULAID": "GXNHLT1101.IXPL.SUMVALUE",
                  "FORMULANAME": "1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼",
                  "score": 90.0906,
                  "fuzzy_score": 94.64,
                  "semantic_score": 84.229,
                  "match_kind": "hybrid"
                },
                {
                  "number": 5,
                  "FORMULAID": "GXNHLT1102.IXPL",
                  "FORMULANAME": "2é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼",
                  "score": 87.1809,
                  "fuzzy_score": 88.88,
                  "semantic_score": 79.0764,
                  "match_kind": "hybrid"
                }
              ]
            }
          ]
        }
      }
    ],
    "relations": [
      {
        "type": "compare",
        "source": 1,
        "target": 2,
        "meta": {
          "via": "pipeline.compare",
          "user_input": [
            "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘",
            "4",
            "4 -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...",
            "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼",
            "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare..."
          ],
          "result": "2022å¹´ï¼Œé«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ä¸1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ç›¸å·®248.1ï¼Œåè€…æ•°å€¼ä¸º0ã€‚"
        }
      }
    ],
    "_next_id": 3
  },
  "meta": {
    "history": [
      {
        "ask": "2022å¹´1å·é«˜ç‚‰å·¥åºèƒ½è€—æ˜¯å¤šå°‘ï¼Œå¯¹æ¯”è®¡åˆ’åå·®å¤šå°‘",
        "reply": "æ²¡æœ‰å®Œå…¨åŒ¹é…çš„[1å·é«˜ç‚‰å·¥åºèƒ½è€—]æŒ‡æ ‡ï¼Œè¯·ä»ä»¥ä¸‹å€™é€‰é€‰æ‹©ç¼–å·(æˆ–è€…é‡æ–°è¾“å…¥å°½é‡ç²¾ç¡®çš„æŒ‡æ ‡åç§°ï¼š\n1) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 91.78)\n2) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼ (score 88.66)\n3) 1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 88.46)\n4) 1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (score 87.77)\n5) é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ (score 87.20)"
      },
      {
        "ask": "4 -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...",
        "reply": "æ²¡æœ‰å®Œå…¨åŒ¹é…çš„[1å·é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’]æŒ‡æ ‡ï¼Œè¯·ä»ä»¥ä¸‹å€™é€‰é€‰æ‹©ç¼–å·(æˆ–è€…é‡æ–°è¾“å…¥å°½é‡ç²¾ç¡®çš„æŒ‡æ ‡åç§°ï¼š\n1) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 93.78)\n2) é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 90.66)\n3) 1é«˜ç‚‰å·¥åºå¹³è¡¡èƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 90.47)\n4) 1é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’ç´¯è®¡å€¼ (score 90.09)\n5) 2é«˜ç‚‰å·¥åºèƒ½è€—è®¡åˆ’æŠ¥å‡ºå€¼ (score 87.18)"
      },
      {
        "ask": "é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ -> system:å®Œæˆ clarify å¹¶æ£€æµ‹åˆ° compare ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œ handle_compare...",
        "reply": "2022å¹´ï¼Œé«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ä¸1é«˜ç‚‰å·¥åºèƒ½è€—å®ç»©æŠ¥å‡ºå€¼ç›¸å·®248.1ï¼Œåè€…æ•°å€¼ä¸º0ã€‚"
      }
    ],
    "current_intent_info": {}
  }
}